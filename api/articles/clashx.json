{"title":"Clash 基本配置记录","uid":"a26d7e330d106e6236762224435c77cc","slug":"clashx","date":"2022-12-05T06:56:16.000Z","updated":"2022-12-05T07:02:12.675Z","comments":true,"path":"api/articles/clashx.json","cover":"yuanyao.jpg","content":"<h3 id=\"规则解释\"><a href=\"#规则解释\" class=\"headerlink\" title=\"规则解释\"></a>规则解释</h3><ul>\n<li>DOMAIN-SUFFIX：域名后缀匹配</li>\n<li>DOMAIN：域名匹配</li>\n<li>DOMAIN-KEYWORD：域名关键字匹配</li>\n<li>IP-CIDR：IP段匹配</li>\n<li>SRC-IP-CIDR：源IP段匹配</li>\n<li>GEOIP：GEOIP数据库（国家代码）匹配</li>\n<li>DST-PORT：目标端口匹配</li>\n<li>SRC-PORT：源端口匹配</li>\n<li>MATCH：全匹配（一般放在最后）</li>\n</ul>\n<h3 id=\"基本配置\"><a href=\"#基本配置\" class=\"headerlink\" title=\"基本配置\"></a>基本配置</h3><pre class=\"line-numbers language-YAML\" data-language=\"YAML\"><code class=\"language-YAML\">#---------------------------------------------------#\n    ## 配置文件需要放置在 $HOME/.config/clash/config.yml\n    ## \n    ## 如果您不知道如何操作，请参阅 SS-Rule-Snippet 的 Wiki：\n    ## https://github.com/Hackl0us/SS-Rule-Snippet/wiki/clash(X)\n    #---------------------------------------------------#\n\n    # HTTP 代理端口\n    port: 7890\n\n    # SOCKS5 代理端口\n    socks-port: 7891\n\n    # Linux 和 macOS 的 redir 代理端口 (如需使用此功能，请取消注释)\n    # redir-port: 7892\n\n    # 允许局域网的连接（可用来共享代理）\n    allow-lan: false\n    # bind-address: \"*\"\n    # 此功能仅在 allow-lan 设置为 true 时生效，支持三种参数：\n    # \"*\"                           绑定所有的 IP 地址\n    # 192.168.122.11                绑定一个的 IPv4 地址\n    # \"[aaaa::a8aa:ff:fe09:57d8]\"   绑定一个 IPv6 地址\n\n    # 规则模式：Rule（规则） / Global（全局代理）/ Direct（全局直连）\n    mode: Rule\n\n    # 设置日志输出级别 (默认级别：silent，即不输出任何内容，以避免因日志内容过大而导致程序内存溢出）。\n    # 5 个级别：silent / info / warning / error / debug。级别越高日志输出量越大，越倾向于调试，若需要请自行开启。\n    log-level: silent\n\n    # clash 的 RESTful API\n    external-controller: 127.0.0.1:9090\n\n    # 您可以将静态网页资源（如 clash-dashboard）放置在一个目录中，clash 将会服务于 `${API}/ui`\n    # 参数应填写配置目录的相对路径或绝对路径。\n    # external-ui: folder\n\n    # RESTful API 的口令 (可选)\n    # secret: \"\"\n\n    # 实验性功能\n    experimental:\n      ignore-resolve-fail: true # 忽略 DNS 解析失败，默认值为 true\n\n    # 本地 SOCKS5 / HTTP(S) 服务认证\n    # authentication:\n    #  - \"user1:pass1\"\n    #  - \"user2:pass2\"\n\n    # # 实验性功能 hosts, 支持通配符 (例如 *.clash.dev 甚至 *.foo.*.example.com)\n    # # 静态的域名 比 通配域名 具有更高的优先级 (foo.example.com 优先于 *.example.com)\n    # # 注意: hosts 在 fake-ip 模式下不生效\n    # hosts:\n    #   '*.clash.dev': 127.0.0.1\n    #   'alpha.clash.dev': '::1'\n\n    dns:\n      enable: true\n      ipv6: false\n      # listen: 0.0.0.0:53\n      # enhanced-mode: redir-host # 或 fake-ip\n      # # fake-ip-range: 198.18.0.1/16 # 如果你不知道这个参数的作用，请勿修改\n      # fake-ip-filter: # fake-ip 白名单列表\n      #   - '*.lan'\n      #   - localhost.ptlogin2.qq.com\n\n      nameserver:\n        - 1.2.4.8\n        - 114.114.114.114\n        - 223.5.5.5\n        - tls://13800000000.rubyfish.cn:853\n        #- https://13800000000.rubyfish.cn/\n\n      fallback: # 与 nameserver 内的服务器列表同时发起请求，当规则符合 GEOIP 在 CN 以外时，fallback 列表内的域名服务器生效。\n        - tls://13800000000.rubyfish.cn:853\n        - tls://1.0.0.1:853\n        - tls://dns.google:853\n\n        #- https://13800000000.rubyfish.cn/\n        #- https://cloudflare-dns.com/dns-query\n        #- https://dns.google/dns-query\n\n      fallback-filter:\n        geoip: true # 默认\n        ipcidr: # 在这个网段内的 IP 地址会被考虑为被污染的 IP\n          - 240.0.0.0/4\n\n    # 1. clash DNS 请求逻辑：\n    #   (1) 当访问一个域名时， nameserver 与 fallback 列表内的所有服务器并发请求，得到域名对应的 IP 地址。\n    #   (2) clash 将选取 nameserver 列表内，解析最快的结果。\n    #   (3) 若解析结果中，IP 地址属于 国外，那么 clash 将选择 fallback 列表内，解析最快的结果。\n    #\n    #   因此，我在 nameserver 和 fallback 内都放置了无污染、解析速度较快的国内 DNS 服务器，以达到最快的解析速度。\n    #   但是 fallback 列表内服务器会用在解析境外网站，为了结果绝对无污染，我仅保留了支持 DoT/DoH 的两个服务器。\n    # \n    # 2. clash DNS 配置注意事项：\n    #   (1) 如果您为了确保 DNS 解析结果无污染，请仅保留列表内以 tls:// 或 https:// 开头的 DNS 服务器，但是通常对于国内域名没有必要。\n    #   (2) 如果您不在乎可能解析到污染的结果，更加追求速度。请将 nameserver 列表的服务器插入至 fallback 列表内，并移除重复项。\n    # \n    # 3. 关于 DNS over HTTPS (DoH) 和 DNS over TLS (DoT) 的选择：\n    #   对于两项技术双方各执一词，而且会无休止的争论，各有利弊。各位请根据具体需求自行选择，但是配置文件内默认启用 DoT，因为目前国内没有封锁或管制。\n    #   DoH: 以 https:// 开头的 DNS 服务器。拥有更好的伪装性，且几乎不可能被运营商或网络管理封锁，但查询效率和安全性可能略低。\n    #   DoT: 以 tls:// 开头的 DNS 服务器。拥有更高的安全性和查询效率，但端口有可能被管制或封锁。\n    #   若要了解更多关于 DoH/DoT 相关技术，请自行查阅规范文档。\n\n\n    Proxy:\n    # shadowsocks\n    # 所支持的加密方式与 go-shadowsocks2 保持一致\n    # 支持加密方式： \n    #   aes-128-gcm aes-192-gcm aes-256-gcm\n    #   aes-128-cfb aes-192-cfb aes-256-cfb\n    #   aes-128-ctr aes-192-ctr aes-256-ctr\n    #   rc4-md5 chacha20 chacha20-ietf xchacha20\n    #   chacha20-ietf-poly1305 xchacha20-ietf-poly1305\n\n      - name: \"ss1\"\n        type: ss\n        server: server\n        port: 443\n        cipher: chacha20-ietf-poly1305\n        password: \"password\"\n        # udp: true  \n\n      - name: \"ss2\"\n        type: ss\n        server: server\n        port: 443\n        cipher: AEAD_CHACHA20_POLY1305\n        password: \"password\"\n        plugin: obfs\n        plugin-opts:\n          mode: tls # 混淆模式，可以选择 http 或 tls\n          host: bing.com # 混淆域名，需要和服务器配置保持一致\n\n      - name: \"ss3\"\n        type: ss\n        server: server\n        port: 443\n        cipher: AEAD_CHACHA20_POLY1305\n        password: \"password\"\n        plugin: v2ray-plugin\n        plugin-opts:\n          mode: websocket # 暂时不支持 QUIC 协议\n          # tls: true # wss\n          # skip-cert-verify: true\n          # host: bing.com\n          # path: \"/\"\n          # headers:\n          #   custom: value\n\n    # vmess\n    # 支持加密方式：auto / aes-128-gcm / chacha20-poly1305 / none\n      - name: \"vmess\"\n        type: vmess\n        server: server\n        port: 443\n        uuid: uuid\n        alterId: 32\n        cipher: auto\n        # udp: true\n        # tls: true\n        # skip-cert-verify: true\n        # network: ws\n        # ws-path: /path\n        # ws-headers:\n        #   Host: v2ray.com\n\n      # socks5\n      - name: \"socks\"\n        type: socks5\n        server: server\n        port: 443\n        # username: username\n        # password: password\n        # tls: true\n        # skip-cert-verify: true\n        # udp: true\n\n      # http\n      - name: \"http\"\n        type: http\n        server: server\n        port: 443\n        # username: username\n        # password: password\n        # tls: true # https\n        # skip-cert-verify: true\n\n      # snell\n      - name: \"snell\"\n        type: snell\n        server: server\n        port: 44046\n        psk: yourpsk\n        # obfs-opts:\n          # mode: http # 或 tls\n          # host: bing.com\n\n    Proxy Group:\n    # url-test 可以自动选择与指定 URL 测速后，延迟最短的服务器\n      - name: \"auto\"\n        type: url-test\n        proxies:\n          - ss1\n          - ss2\n          - vmess1\n        url: 'http://www.gstatic.com/generate_204'\n        interval: 300\n\n    # fallback 可以尽量按照用户书写的服务器顺序，在确保服务器可用的情况下，自动选择服务器\n      - name: \"fallback-auto\"\n        type: fallback\n        proxies:\n          - ss1\n          - ss2\n          - vmess1\n        url: 'http://www.gstatic.com/generate_204'\n        interval: 300\n\n    # load-balance 可以使相同 eTLD 请求在同一条代理线路上\n      - name: \"load-balance\"\n        type: load-balance\n        proxies:\n          - ss1\n          - ss2\n          - vmess1\n        url: 'http://www.gstatic.com/generate_204'\n        interval: 300\n\n    # select 用来允许用户手动选择 代理服务器 或 服务器组\n    # 您也可以使用 RESTful API 去切换服务器，这种方式推荐在 GUI 中使用\n      - name: Proxy\n        type: select\n        proxies:\n          - ss1\n          - ss2\n          - vmess1\n          - auto\n\n    Rule:\n    # 抗 DNS 污染 \n      - DOMAIN-KEYWORD,amazon,Proxy\n      - DOMAIN-KEYWORD,google,Proxy\n      - DOMAIN-KEYWORD,gmail,Proxy\n      - DOMAIN-KEYWORD,youtube,Proxy\n      - DOMAIN-KEYWORD,facebook,Proxy\n      - DOMAIN-SUFFIX,fb.me,Proxy\n      - DOMAIN-SUFFIX,fbcdn.net,Proxy\n      - DOMAIN-KEYWORD,twitter,Proxy\n      - DOMAIN-KEYWORD,instagram,Proxy\n      - DOMAIN-KEYWORD,dropbox,Proxy\n      - DOMAIN-SUFFIX,twimg.com,Proxy\n      - DOMAIN-KEYWORD,blogspot,Proxy\n      - DOMAIN-SUFFIX,youtu.be,Proxy\n      - DOMAIN-KEYWORD,whatsapp,Proxy\n\n    # 常见广告域名屏蔽\n      - DOMAIN-KEYWORD,admarvel,REJECT\n      - DOMAIN-KEYWORD,admaster,REJECT\n      - DOMAIN-KEYWORD,adsage,REJECT\n      - DOMAIN-KEYWORD,adsmogo,REJECT\n      - DOMAIN-KEYWORD,adsrvmedia,REJECT\n      - DOMAIN-KEYWORD,adwords,REJECT\n      - DOMAIN-KEYWORD,adservice,REJECT\n      - DOMAIN-KEYWORD,domob,REJECT\n      - DOMAIN-KEYWORD,duomeng,REJECT\n      - DOMAIN-KEYWORD,dwtrack,REJECT\n      - DOMAIN-KEYWORD,guanggao,REJECT\n      - DOMAIN-KEYWORD,lianmeng,REJECT\n      - DOMAIN-SUFFIX,mmstat.com,REJECT\n      - DOMAIN-KEYWORD,omgmta,REJECT\n      - DOMAIN-KEYWORD,openx,REJECT\n      - DOMAIN-KEYWORD,partnerad,REJECT\n      - DOMAIN-KEYWORD,pingfore,REJECT\n      - DOMAIN-KEYWORD,supersonicads,REJECT\n      - DOMAIN-KEYWORD,uedas,REJECT\n      - DOMAIN-KEYWORD,umeng,REJECT\n      - DOMAIN-KEYWORD,usage,REJECT\n      - DOMAIN-KEYWORD,wlmonitor,REJECT\n      - DOMAIN-KEYWORD,zjtoolbar,REJECT\n\n    # LAN\n      - DOMAIN-SUFFIX,local,DIRECT\n      - IP-CIDR,127.0.0.0/8,DIRECT\n      - IP-CIDR,172.16.0.0/12,DIRECT\n      - IP-CIDR,192.168.0.0/16,DIRECT\n      - IP-CIDR,10.0.0.0/8,DIRECT\n      - IP-CIDR,17.0.0.0/8,DIRECT\n      - IP-CIDR,100.64.0.0/10,DIRECT\n\n    # 最终规则\n      - GEOIP,CN,DIRECT\n      - MATCH,Proxy<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"绕过系统代理\"><a href=\"#绕过系统代理\" class=\"headerlink\" title=\"绕过系统代理\"></a>绕过系统代理</h3><p>Clash for Windows在v 0.4.5 版本后可以自定义系统代理需要绕过的域名或IP</p>\n<p>部分应用检测到系统代理会拒绝响应（例如网易云音乐uwp），此功能用于解决此类问题</p>\n<p>设置方式<br>config.yaml</p>\n<pre class=\"line-numbers language-YAML\" data-language=\"YAML\"><code class=\"language-YAML\">port: 8888\n    socks-port: 8889\n    redir-port: 0\n    allow-lan: true\n    mode: Rule\n    log-level: info\n    external-controller: '0.0.0.0:6170'\n    secret: ''\n    Proxy:\n      ...\n    Proxy Group:\n      ...\n    Rule:\n      ...\n    cfw-bypass:\n      ... # 原有字段不用删除\n      - 'music.163.com' # 网易云域名1\n      - '*.music.126.net' # 网易云域名2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>cfw-bypass类型为数组，item为需要绕过的域名或节点，支持通配符*</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>最后一行对应系统中“请勿将代理服务器用于本地(Intranet)地址”选项，请确保此项在最底部</p></blockquote>\n","feature":true,"text":"规则解释 DOMAIN-SUFFIX：域名后缀匹配 DOMAIN：域名匹配 DOMAIN-KEYWORD：域名关键字匹配 IP-CIDR：IP段匹配 SRC-IP-CIDR：源IP段匹配 GEOIP：GEOIP数据库（国家代码）匹配 DST-PORT：目标端口匹配 SRC-POR...","link":"","photos":[],"count_time":{"symbolsCount":"9k","symbolsTime":"8 mins."},"categories":[{"name":"linux","slug":"linux","count":1,"path":"api/categories/linux.json"}],"tags":[{"name":"clashx","slug":"clashx","count":1,"path":"api/tags/clashx.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%A7%84%E5%88%99%E8%A7%A3%E9%87%8A\"><span class=\"toc-text\">规则解释</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">基本配置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BB%95%E8%BF%87%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%90%86\"><span class=\"toc-text\">绕过系统代理</span></a></li></ol>","author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"家庭宽带开启IPV6","uid":"ccf998b0259d26e6b6cefdf42feb4b5f","slug":"openwrt-ipv6","date":"2022-11-24T13:20:30.000Z","updated":"2022-11-24T13:31:54.559Z","comments":true,"path":"api/articles/openwrt-ipv6.json","cover":[],"text":"常见的运营商超级管理员账号中国移动 移动光猫账号∶CMCCAdmin 密码∶ aDm8H%MdA 华为的∶telecomadmin 密码∶ admintelecom 中国移动光纤宽带ip∶192.168.100.1的超级账号∶telecomadmin 密码∶nE7jA%5m 中国...","link":"","photos":[],"count_time":{"symbolsCount":811,"symbolsTime":"1 mins."},"categories":[{"name":"ipv6","slug":"ipv6","count":1,"path":"api/categories/ipv6.json"}],"tags":[{"name":"ipv6","slug":"ipv6","count":1,"path":"api/tags/ipv6.json"}],"author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}