{"title":"Android导入第三方静态库.a编译成动态库.so","uid":"8213f481efc903643779a1a7fd956892","slug":"android-ndk-so-a","date":"2016-05-11T15:08:51.000Z","updated":"2022-06-15T07:49:16.352Z","comments":true,"path":"api/articles/android-ndk-so-a.json","cover":[],"content":"<p>Android导入第三方静态库.a编译成动态库.so</p>\n<span id=\"more\"></span>\n<img src=\"/post/android-ndk-so-a/img1.png\" class=\"\" title=\"img1\">\n\n<p>下面我以一个简单的实际例子来讲解如何在动态库中导入静态库。</p>\n<p>静态库中的源代码有两个文件：static.h, static.c，有一个add方法 static.h</p>\n<pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">#include &lt;stdio.h&gt; \nint add(int x, int y);\nstatic.c\n#include \"static.h\" \nint add(int x, int y) \n{ \n    return x + y; \n}<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>将它编译成静态库，Android.mk如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">LOCAL_PATH := $(call my-dir) \ninclude $(CLEAR_VARS) \nLOCAL_MODULE    := static_add \nLOCAL_SRC_FILES := static.c \ninclude $(BUILD_STATIC_LIBRARY)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>注意编译静态库的时候，必须有一个Application.mk文件：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>APP_MODULES:=static_add</p></blockquote>\n<p>APP_MODULES的值应该和Android.mk中的LOCAL_MODULE的值保持一样。</p>\n<p>然后调用ndk-build进行编译生成libstatic_add.a静态库</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">hejinlai_iMac:jni hejinlai$ ndk-build\nPrebuilt : libstatic_add.a &lt;= jni/ 生成静态库后，然后编写动态库中的源代码: share.h share.c share.h [cpp]#include \nint test_add(int x, int y);\n\nshare.c\n1234567 #include “share.h”\n#include “static.h”\nint test_add(int x, int y)\n{\n// 调用static里面的方法\nreturn add(x, y);\n}<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>编写导入静态库的Android.mk：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">LOCAL_PATH := $(call my-dir) \ninclude $(CLEAR_VARS) \nLOCAL_MODULE    := static_add \nLOCAL_SRC_FILES := libstatic_add.a \ninclude $(PREBUILT_STATIC_LIBRARY) \ninclude $(CLEAR_VARS) \nLOCAL_MODULE    := share_add \nLOCAL_STATIC_LIBRARIES := static_add \nLOCAL_SRC_FILES := share.c \ninclude $(BUILD_SHARED_LIBRARY)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>注意上面生成的libstatic_add.a必须跟Android.mk放在同一目录下，否则需要填写相应的路径，然后进行编译：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">hejinlai_iMac:jni hejinlai$ ndk-build\nCompile thumb : share_add &lt;= share.c Prebuilt : libstatic_add.a &lt;= jni/ SharedLibrary : libshare_add.so Install : libshare_add.so =&gt; libs/armeabi/libshare_add.so<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>提示so编译成功。</p>\n<p>需要注意的是我这边share.c和static.c放在同一目录下，如果放在不同的目录下，需要指定</p>\n<p>LOCAL_C_INCLUDES链接到相应的路径。</p>\n","text":"Android导入第三方静态库.a编译成动态库.so 下面我以一个简单的实际例子来讲解如何在动态库中导入静态库。 静态库中的源代码有两个文件：static.h, static.c，有一个add方法 static.h #include &lt;stdio.h&gt; int add...","link":"","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"Android","slug":"Android","count":3,"path":"api/categories/Android.json"}],"tags":[{"name":"Andorid","slug":"Andorid","count":2,"path":"api/tags/Andorid.json"},{"name":"ndk","slug":"ndk","count":2,"path":"api/tags/ndk.json"},{"name":"so","slug":"so","count":1,"path":"api/tags/so.json"},{"name":"a","slug":"a","count":1,"path":"api/tags/a.json"}],"toc":"","author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"https://github.com/xxl6097","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"baidu":{"icon":"/img/baidu.jpg","link":"https://www.baidu.com/my/index"}}}},"mapped":true,"prev_post":{"title":"L2TP/IPSec一键安装脚本","uid":"730e3c222d29ca9fe69371da7aa3f4fa","slug":"L2TP-IPSec_sh","date":"2018-04-02T03:04:50.000Z","updated":"2022-06-15T08:23:47.097Z","comments":true,"path":"api/articles/L2TP-IPSec_sh.json","cover":[],"text":"基于 OpenVZ 虚拟化技术的 VPS 需要开启TUN/TAP才能正常使用，购买 VPS 时请先咨询服务商是否支持开启 TUN/TAP。 OpenVZ 虚拟的 VPS 需要系统内核支持 IPSec 才行。也就是说，母服务器的内核如果不支持的话那就没办法，只能换 VPS。因此，一...","link":"","photos":[],"count_time":{"symbolsCount":"3.7k","symbolsTime":"3 mins."},"categories":[{"name":"VPN","slug":"VPN","count":3,"path":"api/categories/VPN.json"}],"tags":[{"name":"shadowsocks","slug":"shadowsocks","count":4,"path":"api/tags/shadowsocks.json"},{"name":"科学上网","slug":"科学上网","count":2,"path":"api/tags/科学上网.json"}],"author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"https://github.com/xxl6097","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"baidu":{"icon":"/img/baidu.jpg","link":"https://www.baidu.com/my/index"}}}}},"next_post":{"title":"喜马拉雅WiFi音响绑定及通讯协议初稿","uid":"285ed5b1fb2c878a0e222864d60850e2","slug":"ximalaya","date":"2016-05-11T14:54:48.000Z","updated":"2022-02-22T10:16:43.640Z","comments":true,"path":"api/articles/ximalaya.json","cover":[],"text":"喜马拉雅WiFi音响绑定及通讯协议初稿 通讯协议 0x5A 数据长度 框架版本 协议类型 设备编码 Mac地址 数据帧序列号 保留字 数据类型 数据内容 检验码FCS 1字节 2字节 1字节 1字节 8字节 6字节 4字节 8字节 2字节 N字节 2字节 通讯Json格式：{ \"...","link":"","photos":[],"count_time":{"symbolsCount":"9.5k","symbolsTime":"9 mins."},"categories":[{"name":"IoT","slug":"IoT","count":4,"path":"api/categories/IoT.json"}],"tags":[{"name":"Andorid","slug":"Andorid","count":2,"path":"api/tags/Andorid.json"},{"name":"智能家居","slug":"智能家居","count":2,"path":"api/tags/智能家居.json"},{"name":"喜马拉雅","slug":"喜马拉雅","count":1,"path":"api/tags/喜马拉雅.json"}],"author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"https://github.com/xxl6097","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"baidu":{"icon":"/img/baidu.jpg","link":"https://www.baidu.com/my/index"}}}}}}