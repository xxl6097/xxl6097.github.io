{"title":"树莓派3B(Raspberry 3B)搭建HomeAssistant","uid":"d9f74a797f08df0b0fe9d63aaea4208d","slug":"homeassistant","date":"2018-05-02T04:14:57.000Z","updated":"2022-02-18T10:17:37.000Z","comments":true,"path":"api/articles/homeassistant.json","cover":[],"content":"<p>Home Assistant 是一款基于 Python 的智能家居开源系统，支持众多品牌的智能家居设备，可以轻松实现设备的语音控制、自动化等。本文档全站内容基于 Home Assistant 官方网站 本地化而成，具有以下特点：</p>\n<p>整合『组件』与『文档』页，采用更直观清晰、符合中文阅读的展现形式；<br>剔除国内用户较少接触的组件说明，提高常用智能家居平台的层级和权重；<br>跳出 Home Assistant 原生框架，一并纳入 Floorplan、HADashboard 等相关衍生项目；<br>本文将讲述树莓派3B搭建HomeAssistant和小米设备的接入。</p>\n<span id=\"more\"></span>\n<h1 id=\"一、系统要求和硬件配置\"><a href=\"#一、系统要求和硬件配置\" class=\"headerlink\" title=\"一、系统要求和硬件配置\"></a>一、系统要求和硬件配置</h1><hr>\n<ul>\n<li>树莓派3B（Raspberry 3B）;</li>\n<li>一张16G的TF存储卡；</li>\n<li>一台电脑（windowns or mac）；</li>\n<li>若干小米设备（小米网关、小米插座、小米吸顶灯等）；</li>\n<li>TF卡读卡器；</li>\n<li>原生 <a href=\"https://www.raspberrypi.org/downloads/raspbian/\">Raspbian</a> 系统；</li>\n<li>xshell工具；</li>\n<li><a href=\"http://www.upantool.com/hfxf/sd/3137.html\">SDFormatter</a>；</li>\n<li><a href=\"http://www.onlinedown.net/soft/110173.htm\">Win32 Disk Imager</a>。</li>\n<li><a href=\"http://www.pc6.com/mac/248733.html\">Etcher Mac版</a>（MacOs下烧录工具）；</li>\n<li>Fing工具（Android端或者ios端都行）。</li>\n</ul>\n<h1 id=\"二、系统安装\"><a href=\"#二、系统安装\" class=\"headerlink\" title=\"二、系统安装\"></a>二、系统安装</h1><hr>\n<ol>\n<li>SDFormatter格式化TF存储卡</li>\n<li>使用Win32 Disk Imager工具烧录Raspbian系统到TF卡</li>\n<li>如果是在MacOs系统下，请用mac自带工具格式化TF卡，然后使用Etcher烧录系统；</li>\n</ol>\n<h1 id=\"三、树莓派配置\"><a href=\"#三、树莓派配置\" class=\"headerlink\" title=\"三、树莓派配置\"></a>三、树莓派配置</h1><hr>\n<ol>\n<li><p>烧录完毕后，TF卡自动命名为boot，<strong>在boot根目录新建ssh文件以便ss登录</strong>；</p>\n</li>\n<li><p>在TF卡根目录新建<code>wpa_supplicant.conf</code>文件，用于连接WiFi，配置如下：</p>\n <pre class=\"line-numbers language-none\"><code class=\"language-none\">\ncountry=CN\nctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\nupdate_config=1\nnetwork={\n    ssid=\"路由器的ssid\"\n    psk=\"路由器的密码\"\n    key_mgmt=WPA-PSK\n    priority=1\n}\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</li>\n<li><p>将TF卡插在树莓派后上电启动；</p>\n</li>\n<li><p>使用Fing查询树莓派的IP地址；</p>\n</li>\n<li><p>树莓派默认用户名<strong>pi</strong>，密码<strong>raspberry</strong>;</p>\n</li>\n<li><p>使用xshell连接树莓派，MacOs方式：<code>ssh pi@192.168.x.x -p 22</code>；</p>\n</li>\n</ol>\n<h2 id=\"3-1-启用root用户（由于本人天性爱自由，所以必须要绝对权限）\"><a href=\"#3-1-启用root用户（由于本人天性爱自由，所以必须要绝对权限）\" class=\"headerlink\" title=\"3.1 启用root用户（由于本人天性爱自由，所以必须要绝对权限）\"></a>3.1 启用root用户（由于本人天性爱自由，所以必须要绝对权限）</h2><ol>\n<li>设置root用户密码</li>\n</ol>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>sudo passwd root</p></blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\npi@raspberrypi:~$ sudo passwd root\nEnter new UNIX password:   #输入第一遍密码\nRetype new UNIX password:  #输入第二遍密码<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"2\">\n<li>启用 root 账号登录<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>sudo passwd –unlock root</p></blockquote>\n</li>\n</ol>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\npi@raspberrypi:~$ sudo passwd --unlock root\npasswd: password expiry information changed.<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<ol start=\"3\">\n<li>设置root登陆</li>\n</ol>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>sudo nano /etc/ssh/sshd_config  </p></blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\npi@raspberrypi:~$ sudo nano /etc/ssh/sshd_config    \n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><code>Ctrl + W</code> 快捷键 搜索 <code>PermitRootLogin without-password</code><br>修改 <code>PermitRootLogin without-password</code> 为 <code>PermitRootLogin yes</code><br>执行完之后，用 <code>reboot</code> 命令重启，这样就可以解锁<code>root</code>账户。</p></blockquote>\n<h1 id=\"四、HomeAssistant安装\"><a href=\"#四、HomeAssistant安装\" class=\"headerlink\" title=\"四、HomeAssistant安装\"></a>四、HomeAssistant安装</h1><hr>\n<h2 id=\"4-1-源替换\"><a href=\"#4-1-源替换\" class=\"headerlink\" title=\"4.1 源替换\"></a>4.1 源替换</h2><p>由于默认都是从国外服务器下载安装，为了避免安装失败所以先替换成阿里的源。</p>\n<ul>\n<li><p>在此目录新建此文件：<code> ~/.pip/pip.conf</code></p>\n</li>\n<li><p>复制粘贴以下内容并保存：</p>\n</li>\n</ul>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n[global]\ntrusted-host=mirrors.aliyun.com\nindex-url=https://mirrors.aliyun.com/pypi/simple/\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h2 id=\"4-2-安装Python3\"><a href=\"#4-2-安装Python3\" class=\"headerlink\" title=\"4.2 安装Python3\"></a>4.2 安装Python3</h2><p>打开<code>Linux</code>系统命令行窗口，输入：<code>sudo apt-get install python3.5</code></p>\n<p>应系统要求输入<code>root</code>账号的密码。</p>\n<img src=\"/post/homeassistant/1.png\" class=\"\" title=\"img1\">\n\n<p>安装资源准备好后提问是否继续安装，打回车确认。<br>然后等待安装完成。</p>\n<img src=\"/post/homeassistant/2.png\" class=\"\" title=\"img1\">\n\n\n<h2 id=\"4-3-安装Python3开发资源\"><a href=\"#4-3-安装Python3开发资源\" class=\"headerlink\" title=\"4.3 安装Python3开发资源\"></a>4.3 安装Python3开发资源</h2><p>在第一步安装完成后，继续输入命令：<code>sudo apt-get install python3.5-dev</code><br>在系统提问是否继续安装时打回车确认。<br>然后等待安装完成。</p>\n<img src=\"/post/homeassistant/3.png\" class=\"\" title=\"img1\">\n\n<img src=\"/post/homeassistant/4.png\" class=\"\" title=\"img1\">\n\n\n<h2 id=\"4-4-安装Pip3\"><a href=\"#4-4-安装Pip3\" class=\"headerlink\" title=\"4.4 安装Pip3\"></a>4.4 安装Pip3</h2><p>继续在命令行中输入：<code>sudo apt install python3-pip</code><br>回车确认安装。<br>等待安装完成。</p>\n<img src=\"/post/homeassistant/5.png\" class=\"\" title=\"img1\">\n\n\n<h2 id=\"4-5-验证安装结果\"><a href=\"#4-5-验证安装结果\" class=\"headerlink\" title=\"4.5 验证安装结果\"></a>4.5 验证安装结果</h2><p>在命令行中输入<code>python3 --version</code>，看到显示版本。<br>在命令行中输入<code>pip3 --version</code>，看到显示版本。<br>说明Python3环境及Pip3工具安装成功。</p>\n<img src=\"/post/homeassistant/6.png\" class=\"\" title=\"img1\">\n\n\n<h2 id=\"4-6-使用Pip工具安装Home-Assistant\"><a href=\"#4-6-使用Pip工具安装Home-Assistant\" class=\"headerlink\" title=\"4.6 使用Pip工具安装Home Assistant\"></a>4.6 使用Pip工具安装Home Assistant</h2><p>在此步之前建议设置国内的安装源，可以提升后续的速度，参见这篇文档。<br>打开命令行窗口，输入：<code>sudo pip3 install homeassistant</code> （<font color=\"red\">此步骤若失败，请重复操作</font>）<br>等待安装过程完成。</p>\n<img src=\"/post/homeassistant/8.png\" class=\"\" title=\"img1\">\n\n\n<h2 id=\"4-7-验证安装结果\"><a href=\"#4-7-验证安装结果\" class=\"headerlink\" title=\"4.7 验证安装结果\"></a>4.7 验证安装结果</h2><p>在命令行窗口，输入：<code>hass --debug</code> 参数<code>--debug</code>可以查看启动的日志。<br>首次启动需要初始化配置文件，也会自动下载一些所需的文件，会需要一些时间。有时因网络质量问题还会出现文件下载失败情况，导致启动过程受阻。此时可以关闭命令行窗口，再重新执行启动命令。</p>\n<img src=\"/post/homeassistant/9.png\" class=\"\" title=\"img1\">\n\n<p>继续等待启动过程完成，直到浏览器自动打开<code>Home Assistant</code>系统首页，即表明软件安装成功。</p>\n<img src=\"/post/homeassistant/10.png\" class=\"\" title=\"img1\">\n\n\n<h1 id=\"五、HomeAssistant设置自动启动\"><a href=\"#五、HomeAssistant设置自动启动\" class=\"headerlink\" title=\"五、HomeAssistant设置自动启动\"></a>五、HomeAssistant设置自动启动</h1><hr>\n<p>Home Assistant 针对树莓派的发行版（手动安装除外）中都已经自带自启任务，其余系统安装的用户需要自行配置自启。</p>\n<h2 id=\"5-1-配置自启动文件\"><a href=\"#5-1-配置自启动文件\" class=\"headerlink\" title=\"5.1 配置自启动文件\"></a>5.1 配置自启动文件</h2><p>如果你未使用 <code>Python</code> 虚拟环境安装 <code>Home Assistant</code>，请使用以下方法</p>\n<pre><code>sudo nano -w /etc/systemd/system/home-assistant@root.service\n</code></pre>\n<p>复制粘贴</p>\n<pre><code>[Unit]\nDescription=Home Assistant\nAfter=network-online.target\n\n[Service]\nType=simple\nUser=%i\nExecStart=/usr/local/bin/hass \n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意<code>ExecStart=/usr/local/bin/hass</code>  这个路径使用<code>whereis hass</code>查看路径</p></blockquote>\n<h2 id=\"5-2-启动自启服务\"><a href=\"#5-2-启动自启服务\" class=\"headerlink\" title=\"5.2 启动自启服务\"></a>5.2 启动自启服务</h2><p>完成上述步骤后，请重新加载进程管理。</p>\n<pre><code>sudo systemctl --system daemon-reload\n</code></pre>\n<p>启用服务：</p>\n<pre><code>sudo systemctl enable home-assistant@root\n</code></pre>\n<h1 id=\"六、HomeAssistant的一些常用命令\"><a href=\"#六、HomeAssistant的一些常用命令\" class=\"headerlink\" title=\"六、HomeAssistant的一些常用命令\"></a>六、HomeAssistant的一些常用命令</h1><hr>\n<h2 id=\"6-1-systemd相关的控制命令\"><a href=\"#6-1-systemd相关的控制命令\" class=\"headerlink\" title=\"6.1 systemd相关的控制命令\"></a>6.1 systemd相关的控制命令</h2><pre><code>sudo systemctl --system daemon-reload：重新加载systemd的配置文件。\nsudo systemctl enable home-assistant@root：设置home-assitant服务为自启动。\nsudo systemctl disable home-assistant@root：从自启动中去除home-assitant服务。\nsudo systemctl start home-assistant@root：手工启动home-assitant服务（命令中start可以替换成stop、restart、status，完成停止、重启、查看服务状态等功能）。\nsudo journalctl -f -u home-assistant@root：查看hass的日志输出。\nsudo journalctl -f -u home-assistant@[your user] | grep -i 'error'：查看hass的日志输出中的error部分\n\nsudo systemctl restart home-assistant@root\n</code></pre>\n<h2 id=\"6-2-使用脚本控制HomeAssistant\"><a href=\"#6-2-使用脚本控制HomeAssistant\" class=\"headerlink\" title=\"6.2 使用脚本控制HomeAssistant\"></a>6.2 使用脚本控制HomeAssistant</h2><pre><code>#!/bin/bash\n\nfunction check()\n{\n    echo \"检查配置文件是否有错误\"\n    sudo hass --script check_config\n}\n\nfunction dis()\n{\n    echo \"显示所有组件的配置信息\"\n    sudo hass --script check_config --info all\n}\n\nfunction hass()\n{\n    echo \"启动hass\"\n    sudo systemctl start home-assistant@root\n}\nfunction rehass()\n{\n    echo \"重启hass\"\n    sudo systemctl restart home-assistant@root\n}\n\nfunction stophass()\n{\n    echo \"停止hass\"\n    sudo systemctl stop home-assistant@root\n}\n\nfunction log(){\n    echo \"查看hass日志\"\n    sudo journalctl -f -u home-assistant@root\n}\n\nfunction debug(){\n    echo \"debug hass\"\n    sudo hass --debug\n}\n\n\n\necho \"输入编号选择\"\necho \"1. 检查配置文件是否有错误\"\necho \"2. 显示所有组件的配置信息\"\necho \"3. 启动hass\"\necho \"4. 查看hass日志\"\necho \"5. 重启hass\"\necho \"6. 停止hass\"\necho \"7. debug hass\"\necho \"******Enter nothing to exit*****\"\nread num\n\ncase \"$num\" in\n[1] ) (check);;\n[2] ) (dis);;\n[3] ) (hass);;\n[4] ) (log);;\n[5] ) (rehass);;\n[6] ) (stophass);;\n[7] ) (debug);;\n*) echo \"nothing,exit\";;\nesac\n</code></pre>\n<h1 id=\"七、小米设备接入\"><a href=\"#七、小米设备接入\" class=\"headerlink\" title=\"七、小米设备接入\"></a>七、小米设备接入</h1><hr>\n<ul>\n<li><p>安装米家App（最新版本获取获取不到<code>Token</code>，使用【<a href=\"http://uuxia.cn:8123/file/com.xiaomi.smarthome.apk\">MI Home5.0.19</a>】此版本OK）;</p>\n</li>\n<li><p>使用<a href=\"http://uuxia.cn:8123/file/RE.apk\">RE文件管理器</a>，打开<code>/data/data/com.xiaomi.smarthome/databases/miio2.db</code></p>\n</li>\n<li><p>记录设备的<code>token</code></p>\n</li>\n<li><p><a href=\"http://uuxia.cn:8123/file/configuration.yaml\">configuration.yaml</a>配置文件</p>\n</li>\n</ul>\n<h1 id=\"八、遇到的一些问题\"><a href=\"#八、遇到的一些问题\" class=\"headerlink\" title=\"八、遇到的一些问题\"></a>八、遇到的一些问题</h1><hr>\n<ol>\n<li>urllib3与chardet不兼容解决方案</li>\n</ol>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\npip3 uninstall urllib3\npip3 uninstall  chardet\nip3 install requests\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<p>2.执行sh ./xxx.sh出现：“Syntax error: “(” unexpected”的解决方法</p>\n<pre><code>sudo dpkg-reconfigure dash\n在选择项中选No，搞定了！\n</code></pre>\n<ol start=\"3\">\n<li>nodejs安装</li>\n</ol>\n<p><a href=\"https://blog.csdn.net/xiongtm/article/details/77620005\">https://blog.csdn.net/xiongtm/article/details/77620005</a><br><a href=\"https://nodejs.org/dist/latest-v9.x/\">https://nodejs.org/dist/latest-v9.x/</a></p>\n","text":"Home Assistant 是一款基于 Python 的智能家居开源系统，支持众多品牌的智能家居设备，可以轻松实现设备的语音控制、自动化等。本文档全站内容基于 Home Assistant 官方网站 本地化而成，具有以下特点： 整合『组件』与『文档』页，采用更直观清晰、符合中文...","link":"","photos":[],"count_time":{"symbolsCount":"5k","symbolsTime":"5 mins."},"categories":[{"name":"IoT","slug":"IoT","count":4,"path":"api/categories/IoT.json"}],"tags":[{"name":"IoT","slug":"IoT","count":1,"path":"api/tags/IoT.json"},{"name":"HomeAssistant","slug":"HomeAssistant","count":1,"path":"api/tags/HomeAssistant.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82%E5%92%8C%E7%A1%AC%E4%BB%B6%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">一、系统要求和硬件配置</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">二、系统安装</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%89%E3%80%81%E6%A0%91%E8%8E%93%E6%B4%BE%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">三、树莓派配置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-1-%E5%90%AF%E7%94%A8root%E7%94%A8%E6%88%B7%EF%BC%88%E7%94%B1%E4%BA%8E%E6%9C%AC%E4%BA%BA%E5%A4%A9%E6%80%A7%E7%88%B1%E8%87%AA%E7%94%B1%EF%BC%8C%E6%89%80%E4%BB%A5%E5%BF%85%E9%A1%BB%E8%A6%81%E7%BB%9D%E5%AF%B9%E6%9D%83%E9%99%90%EF%BC%89\"><span class=\"toc-text\">3.1 启用root用户（由于本人天性爱自由，所以必须要绝对权限）</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%9B%9B%E3%80%81HomeAssistant%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">四、HomeAssistant安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-1-%E6%BA%90%E6%9B%BF%E6%8D%A2\"><span class=\"toc-text\">4.1 源替换</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-2-%E5%AE%89%E8%A3%85Python3\"><span class=\"toc-text\">4.2 安装Python3</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-3-%E5%AE%89%E8%A3%85Python3%E5%BC%80%E5%8F%91%E8%B5%84%E6%BA%90\"><span class=\"toc-text\">4.3 安装Python3开发资源</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-4-%E5%AE%89%E8%A3%85Pip3\"><span class=\"toc-text\">4.4 安装Pip3</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-5-%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">4.5 验证安装结果</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-6-%E4%BD%BF%E7%94%A8Pip%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85Home-Assistant\"><span class=\"toc-text\">4.6 使用Pip工具安装Home Assistant</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-7-%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">4.7 验证安装结果</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%94%E3%80%81HomeAssistant%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">五、HomeAssistant设置自动启动</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-1-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">5.1 配置自启动文件</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-2-%E5%90%AF%E5%8A%A8%E8%87%AA%E5%90%AF%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">5.2 启动自启服务</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%85%AD%E3%80%81HomeAssistant%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">六、HomeAssistant的一些常用命令</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-1-systemd%E7%9B%B8%E5%85%B3%E7%9A%84%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">6.1 systemd相关的控制命令</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-2-%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E6%8E%A7%E5%88%B6HomeAssistant\"><span class=\"toc-text\">6.2 使用脚本控制HomeAssistant</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%83%E3%80%81%E5%B0%8F%E7%B1%B3%E8%AE%BE%E5%A4%87%E6%8E%A5%E5%85%A5\"><span class=\"toc-text\">七、小米设备接入</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%85%AB%E3%80%81%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">八、遇到的一些问题</span></a></li></ol>","author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"https://github.com/xxl6097","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"baidu":{"icon":"https://himg.bdimg.com/sys/portrait/item/public.1.868e95ea.DjJabcwawzIP0jmepO6KfQ.jpg","link":"https://www.baidu.com/my/index"}}}},"mapped":true,"prev_post":{"title":"健身运动","uid":"0670bb48035640620318bcdcbb65df82","slug":"lifehealth","date":"2018-05-21T06:00:14.000Z","updated":"2022-02-18T10:17:38.000Z","comments":true,"path":"api/articles/lifehealth.json","cover":[],"text":" 健身圈从来就是一个强者的舞台，有的人通过健身强健了体魄，有的人通过健身找到了自信。正所谓“一入健身深似海”，健身就是有这样的魔力让你欲罢不能。 深蹲跳 锻炼部位：股四头肌、腘绳肌、臀大肌、腓肠肌。 俯卧撑 锻炼部位：胸大肌、肱三头肌。 开合跳 锻炼部位：股四头肌、三角肌、比目鱼...","link":"","photos":[],"count_time":{"symbolsCount":214,"symbolsTime":"1 mins."},"categories":[{"name":"生活","slug":"生活","count":4,"path":"api/categories/生活.json"}],"tags":[{"name":"生活","slug":"生活","count":2,"path":"api/tags/生活.json"},{"name":"运动","slug":"运动","count":1,"path":"api/tags/运动.json"}],"author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"https://github.com/xxl6097","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"baidu":{"icon":"https://himg.bdimg.com/sys/portrait/item/public.1.868e95ea.DjJabcwawzIP0jmepO6KfQ.jpg","link":"https://www.baidu.com/my/index"}}}}},"next_post":{"title":"Centos后台运行jar","uid":"7467bff88247b93566ab0f6f498d8860","slug":"centos_run_jar","date":"2018-04-05T08:24:57.000Z","updated":"2022-02-18T10:17:38.000Z","comments":true,"path":"api/articles/centos_run_jar.json","cover":null,"text":"jar后台运行 jar后台运行nohup java -jar xx.jar &gt;/dev/null &amp; 此处的“&gt;/dev/null”作用是将终端输出信息输出到空洞中，即不保存输出信息，若要查看输出信息需指定输出到那个文件，例如“&gt;/xxx/yyy.out...","link":"","photos":[],"count_time":{"symbolsCount":211,"symbolsTime":"1 mins."},"categories":[{"name":"Centos","slug":"Centos","count":1,"path":"api/categories/Centos.json"}],"tags":[{"name":"Java","slug":"Java","count":1,"path":"api/tags/Java.json"},{"name":"Jar","slug":"Jar","count":1,"path":"api/tags/Jar.json"}],"author":{"name":"uuxia","slug":"blog-author","avatar":"/medias/avatar.jpg","link":"/","description":"一位正在重塑知识的技术人 <br /> @ <b>欢迎光临</b>","socials":{"github":"https://github.com/xxl6097","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"baidu":{"icon":"https://himg.bdimg.com/sys/portrait/item/public.1.868e95ea.DjJabcwawzIP0jmepO6KfQ.jpg","link":"https://www.baidu.com/my/index"}}}}}}